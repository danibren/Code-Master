<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Daily Motivation Generator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Apply Inter font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Light slate background */
        }
        /* Custom styling for a vibrant, shadow effect on the card */
        #quote-card {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        /* Style for buttons */
        .btn-base {
            transition: all 0.15s ease-in-out;
            cursor: pointer;
        }
        .btn-base:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-3xl text-center">

        <h1 class="text-5xl font-extrabold text-gray-900 mb-8 sm:text-6xl">
            Daily <span class="text-indigo-600">Boost</span>
        </h1>

        <div id="quote-card" class="bg-white p-8 md:p-12 rounded-2xl border border-gray-100 transition-all duration-300 opacity-100">

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="hidden flex justify-center items-center h-20">
                <div class="loading-spinner"></div>
                <p class="ml-4 text-indigo-600 font-semibold">Generating inspiration...</p>
            </div>

            <!-- Quote Text -->
            <p id="quote-text" class="text-2xl italic text-gray-700 leading-relaxed mb-6 sm:text-3xl font-medium">
                "Click a button below to get your dose of daily inspiration!"
            </p>

            <!-- Quote Author -->
            <p id="quote-author" class="text-lg font-semibold text-indigo-500 sm:text-xl">
                — Gemini
            </p>

            <!-- Error/Status Message Box -->
            <div id="message-box" class="mt-4 p-3 hidden rounded-lg text-sm font-medium" role="alert"></div>

        </div>

        <!-- Button Section -->
        <div class="mt-8 flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
            
            <button id="generate-classic-btn"
                    class="btn-base px-6 py-3 bg-gray-500 text-white font-bold rounded-full text-base tracking-wider
                           shadow-lg shadow-gray-500/50 hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-300
                           active:bg-gray-700"
                    onclick="generateClassicQuote()">
                Classic Quotes
            </button>

            <button id="generate-gemini-random-btn"
                    class="btn-base px-6 py-3 bg-indigo-600 text-white font-bold rounded-full text-base tracking-wider
                           shadow-lg shadow-indigo-500/50 hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300
                           active:bg-indigo-800"
                    onclick="generateGeminiQuoteRandom()">
                ✨ Generate Random Quote
            </button>

        </div>
        
        <!-- Topic Generation Section -->
        <div class="mt-12 p-6 bg-white rounded-xl shadow-lg border border-indigo-100">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Topic Focus</h2>
            <div class="flex flex-col sm:flex-row gap-3">
                <input type="text" id="topic-input" placeholder="e.g., resilience, coding, nature"
                       class="flex-grow p-3 border border-indigo-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-gray-700">
                
                <button id="generate-gemini-topic-btn"
                        class="btn-base px-6 py-3 bg-fuchsia-600 text-white font-bold rounded-lg text-base tracking-wider
                               shadow-lg shadow-fuchsia-500/50 hover:bg-fuchsia-700 focus:outline-none focus:ring-4 focus:ring-fuchsia-300
                               active:bg-fuchsia-800"
                        onclick="generateGeminiQuoteByTopic()">
                    ✨ Generate by Topic
                </button>
            </div>
        </div>

    </div>

    <script>
        // --- GEMINI API SETUP ---
        const apiKey = ""; // API Key is automatically supplied by the canvas environment
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        const MAX_RETRIES = 5;

        // UI Elements
        const quoteTextElement = document.getElementById('quote-text');
        const quoteAuthorElement = document.getElementById('quote-author');
        const quoteCard = document.getElementById('quote-card');
        const loadingIndicator = document.getElementById('loading-indicator');
        const messageBox = document.getElementById('message-box');
        const topicInput = document.getElementById('topic-input');
        
        // Buttons
        const classicBtn = document.getElementById('generate-classic-btn');
        const randomBtn = document.getElementById('generate-gemini-random-btn');
        const topicBtn = document.getElementById('generate-gemini-topic-btn');


        /**
         * Helper to update the UI with a new quote and handle transitions.
         * @param {string} text - The quote text.
         * @param {string} author - The quote author.
         */
        function updateUI(text, author) {
            // Hide loading and message box
            loadingIndicator.classList.add('hidden');
            messageBox.classList.add('hidden');

            // Apply a simple transition class for a visual pop effect
            quoteCard.classList.remove('opacity-100');
            quoteCard.classList.add('opacity-0');

            setTimeout(() => {
                quoteTextElement.textContent = `"${text}"`;
                quoteAuthorElement.textContent = `— ${author}`;

                quoteCard.classList.remove('opacity-0');
                quoteCard.classList.add('opacity-100');
            }, 150);
        }

        /**
         * Helper to show a status or error message.
         * @param {string} message - The message to display.
         * @param {string} type - 'error' or 'success'.
         */
        function showMessage(message, type) {
            messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-800');
            messageBox.textContent = message;
            if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-800');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'text-green-800');
            }
        }

        /**
         * Toggles the disabled state of the buttons.
         * @param {boolean} disabled - True to disable, false to enable.
         */
        function setButtonsDisabled(disabled) {
            classicBtn.disabled = disabled;
            randomBtn.disabled = disabled;
            topicBtn.disabled = disabled;
            // Visually indicate disabled state (optional, Tailwind doesn't have a specific 'disabled' style)
            [classicBtn, randomBtn, topicBtn].forEach(btn => {
                if (disabled) {
                    btn.style.opacity = '0.5';
                    btn.classList.add('cursor-not-allowed');
                } else {
                    btn.style.opacity = '1';
                    btn.classList.remove('cursor-not-allowed');
                }
            });
        }


        /**
         * Core function to call the Gemini API with exponential backoff.
         * @param {string} userQuery - The main text prompt.
         * @param {object} schema - The JSON schema for structured output.
         * @param {number} attempt - Current retry attempt (starts at 1).
         * @returns {Promise<object>} The parsed JSON response from the model.
         */
        async function callGeminiApi(userQuery, schema, attempt = 1) {
            const systemPrompt = "You are a world-class motivational speaker and philosopher. Your task is to craft a concise, profound, and unique quote based on the user's request. The quote must be a single sentence or short paragraph. You must always attribute the quote to a fictional philosopher or figure whose name is relevant to the quote's topic, for example, 'A. I. Rithm' for coding, or 'Professor E. Quilibrium' for balance. Respond only in the requested JSON format.";

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: schema,
                }
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                // Check for a valid text part in the response
                const textPart = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!textPart) {
                    throw new Error("Gemini API response was empty or malformed.");
                }

                return JSON.parse(textPart);

            } catch (error) {
                console.error(`Attempt ${attempt} failed:`, error);
                if (attempt < MAX_RETRIES) {
                    // Exponential backoff
                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return callGeminiApi(userQuery, schema, attempt + 1); // Retry
                }
                throw new Error("Failed to generate quote after multiple retries. Please try again.");
            }
        }


        // --- GEMINI POWERED FUNCTIONS ---

        /**
         * Generates a completely random, unique motivational quote using the Gemini API.
         */
        async function generateGeminiQuoteRandom() {
            setButtonsDisabled(true);
            loadingIndicator.classList.remove('hidden');
            messageBox.classList.add('hidden');

            const quoteSchema = {
                type: "OBJECT",
                properties: {
                    "quote": { "type": "STRING", "description": "The motivational quote text, wrapped in quotation marks." },
                    "author": { "type": "STRING", "description": "The name of the fictional philosopher/figure." }
                },
                required: ["quote", "author"]
            };

            try {
                const userQuery = "Generate a completely random, universally applicable motivational quote.";
                const responseJson = await callGeminiApi(userQuery, quoteSchema);
                
                const quote = responseJson.quote.replace(/^["'“”‘](.*)["'“”’]$/, '$1'); // Remove surrounding quotes if present
                updateUI(quote, responseJson.author);
                
            } catch (error) {
                console.error("Gemini Random Quote Error:", error);
                updateUI("Failed to fetch inspiration.", "Server Error");
                showMessage("Sorry, I couldn't generate a quote right now. Please check the console for details.", 'error');
            } finally {
                setButtonsDisabled(false);
            }
        }

        /**
         * Generates a unique motivational quote based on the user's specified topic.
         */
        async function generateGeminiQuoteByTopic() {
            const topic = topicInput.value.trim();
            if (!topic) {
                showMessage("Please enter a topic before generating a quote.", 'error');
                return;
            }

            setButtonsDisabled(true);
            loadingIndicator.classList.remove('hidden');
            messageBox.classList.add('hidden');
            
            const quoteSchema = {
                type: "OBJECT",
                properties: {
                    "quote": { "type": "STRING", "description": "The motivational quote text, wrapped in quotation marks." },
                    "author": { "type": "STRING", "description": "The name of the fictional philosopher/figure." }
                },
                required: ["quote", "author"]
            };

            try {
                const userQuery = `Generate a profound motivational quote specifically about the topic of: ${topic}`;
                const responseJson = await callGeminiApi(userQuery, quoteSchema);
                
                const quote = responseJson.quote.replace(/^["'“”‘](.*)["'“”’]$/, '$1'); // Remove surrounding quotes if present
                updateUI(quote, responseJson.author);

            } catch (error) {
                console.error("Gemini Topic Quote Error:", error);
                updateUI("Failed to fetch inspiration for that topic.", "Server Error");
                showMessage("Sorry, the quote generation failed. Please try a different topic.", 'error');
            } finally {
                setButtonsDisabled(false);
            }
        }


        // --- CLASSIC (HARDCODED) FUNCTION ---

        // Array of motivational quotes
        const quotes = [
            {
                text: "The best way to predict the future is to create it.",
                author: "Peter Drucker"
            },
            {
                text: "The only way to do great work is to love what you do.",
                author: "Steve Jobs"
            },
            {
                text: "Success is not final, failure is not fatal: it is the courage to continue that counts.",
                author: "Winston Churchill"
            },
            {
                text: "Strive not to be a success, but rather to be of value.",
                author: "Albert Einstein"
            },
            {
                text: "The journey of a thousand miles begins with a single step.",
                author: "Lao Tzu"
            },
            {
                text: "Change the world by being yourself.",
                author: "Amy Poehler"
            },
            {
                text: "The mind is everything. What you think you become.",
                author: "Buddha"
            }
        ];

        let lastIndex = -1;

        /**
         * Selects a random quote from the hardcoded array.
         */
        function generateClassicQuote() {
            setButtonsDisabled(false); // Ensure buttons are enabled
            loadingIndicator.classList.add('hidden');
            messageBox.classList.add('hidden');

            let newIndex;
            do {
                // Generate a random index within the quotes array length
                newIndex = Math.floor(Math.random() * quotes.length);
            } while (newIndex === lastIndex && quotes.length > 1); // Ensure variety

            const randomQuote = quotes[newIndex];
            updateUI(randomQuote.text, randomQuote.author);
            lastIndex = newIndex; // Update the last used index
        }
    </script>

</body>
</html>
